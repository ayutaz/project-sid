# 社会・計画・評価システム レビュー

## エグゼクティブサマリー

対象3ドキュメント（06-social-cognition.md、07-goal-planning.md、09-evaluation.md）は、全体として**高品質**な実装設計である。論文のSAS（Social Awareness System）の定量結果を正確に引用し、コードレベルの設計に落とし込んでいる点は優れている。しかし、以下の主要課題が特定された。

**重大な問題（Critical）**: 2件
- 社会認識モジュールの用語混乱（SAS vs Social Awareness Module）
- 行動認識モジュールの学習データ不在問題（Phase 0で学習データなしにNNモデルをどう用意するか）

**高優先度問題（High）**: 4件
- 06で社会目標生成を扱う一方、07でも同機能を定義し、責務が重複
- 評価ドキュメント(09)における「観察者閾値」の定義が論文の意図と異なる可能性
- 論文の「集団ルール実験」のタイムラインに不整合
- 感情スコアの時間減衰モデルは論文に根拠がない独自追加

**中優先度問題（Medium）**: 6件

全体評価: **B+** — 論文の再現に必要な情報は概ね網羅されているが、モジュール間の責務分離と論文根拠の明示性に改善が必要。

---

## レビュー対象
- 06-social-cognition.md（社会的認知モジュール実装設計）
- 07-goal-planning.md（目標・計画システム実装設計）
- 09-evaluation.md（評価・ベンチマークシステム実装ガイド）

## 参照元
- docs/04-multi-agent.md（マルチエージェントの進化 — 論文分析）
- docs/08-evaluation.md（総合評価 — 論文分析）
- docs/05-civilization.md（文明的進化プロセス — 論文分析）

---

## 詳細レビュー

### 1. 論文との整合性

#### 1.1 正確に反映されている点

- **好感度スコア**: 0-10離散スケール、r=0.807（観察者閾値5）、r=0.617（モジュールなし）、r=0.907（観察者閾値11）が正確に引用されている（06: L13-21、09: L1058-1061）
- **回帰勾配**: 0.373（モジュールあり）、0.161（モジュールなし）が正確（06: L18-19）
- **実験パラメータ**: 50体実験、4時間超、専門化30体/20分、集団ルール29体/1200秒が論文と一致
- **6種類の創発的役割**: farmer, miner, engineer, guard, explorer, blacksmithが05-civilization.mdと完全一致
- **民主的プロセスのタイムライン**: フィードバック(300-360秒)→修正案(360-420秒)→投票(420秒)が論文と一致
- **パスタファリアニズムのキーワード分類**: 直接/間接改宗の分類が論文と一致

#### 1.2 不整合・問題点

**[C-1] 用語の不統一: SAS vs Social Awareness Module**

論文ではSocial Awareness **System** (SAS) という用語を使用しているが、実装ドキュメント06ではSocial Awareness **Module**として記述している。論文のSASはPIANOアーキテクチャ内の1モジュールであり、概念的には同一だが、論文のSASはより広範な概念（社会的認知全般のサブシステム）を指す可能性がある。用語を論文に合わせるか、意図的な変更であればその理由を明記すべき。

参照: docs/04-multi-agent.md L17-18で「社会認識モジュール（Social Awareness Module）」と表記。論文分析ドキュメント自体も同じ表記を使用しているため、論文原文との照合が必要。

**[H-1] 集団ルール実験のタイムライン不整合**

09-evaluation.md L475-488のプロセスフロー:
```
Phase 1: フィードバック収集（300-360秒）
Phase 2: 修正案処理（360-420秒）
Phase 3: 投票（420秒）
Phase 4: 憲法更新（420-600秒）
```

一方、09-evaluation.md L381-386の実験パラメータ:
```
課税シーズン数: 10回（修正前5回 + 修正後5回）
課税ウィンドウ: 各20秒
```

論文分析（05-civilization.md L76-80）では:
```
修正前: 0-600秒、120秒間隔で5回
修正後: 600-1200秒
```

修正前5回 x 120秒 = 600秒は整合するが、「課税ウィンドウ: 各20秒」の記述は論文分析と異なる。論文分析では「120秒間隔」であり、「各20秒のウィンドウ」内で課税イベントが発生するのか、120秒の全体が課税シーズンなのかが曖昧。

**[H-2] 感情スコアの時間減衰は論文に根拠なし**

06-social-cognition.md L328-337のtime decay機構:
```python
def _apply_time_decay(self, record: SentimentRecord) -> int:
    decay = score + (5 - score) * (1 - e^(-rate * elapsed))
```

この「長時間対話がないと中立(5)に回帰」する仕組みは、論文には記載されていない。論文では好感度スコアの減衰については言及していない。これは合理的な設計判断ではあるが、**論文の知見に基づく設計**と**独自の拡張**を明確に区別すべきである。

**[M-1] 観察者閾値の解釈**

09-evaluation.md L1118-1126の`compute_accuracy`メソッドで、`observer_threshold`は「ターゲットを評価した観察者の最小数」としている。しかし論文の「観察者閾値」は、各ターゲットについて**少なくともN人の他エージェントが評価している場合のみ**そのターゲットをサンプルに含めるフィルタリング条件である。実装の意図は同じだが、コード上では`min_observers`パラメータが`aggregate_likeability`（06: L911）では対話回数の閾値として使われており、概念が混在している。

---

### 2. 社会認知モジュール

#### 2.1 感情追跡（06-social-cognition.md セクション2）

**強み:**
- `SentimentTracker`のスムージングアルゴリズム（L309-315）は、急激な変動を抑制しつつ新しい評価を反映するバランスの取れた設計
- `stability = min(interaction_count / 20.0, 0.7)`による安定性制御は、対話回数が増えるほどスコアが安定するという合理的な設計
- 非対称的関係の検出（`get_relationship_asymmetry`）が論文の「片想い的関係」の知見を反映

**問題点:**

**[M-2] スムージングの重みパラメータの根拠不足**

L310-311:
```python
stability = min(current.interaction_count / 20.0, 0.7)
weight_new = confidence * (1.0 - stability)
```

`20.0`や`0.7`といったマジックナンバーの根拠が不明。論文にはスムージングの具体的パラメータの記述がないため、これらは実験的チューニングが必要な値として明示すべき。

**[M-3] confidence=0.8のデフォルト値**

`update_score`メソッド（L288）の`confidence`デフォルト値0.8は楽観的すぎる可能性がある。LLMの好感度評価は不確実性が高いため、初期値は0.5-0.6程度が適切かもしれない。ただし、これは実装フェーズでのチューニング事項。

#### 2.2 好感度推定とLLMプロンプト（06 セクション1.3）

**強み:**
- `SENTIMENT_EVALUATION_PROMPT`の0-10スケール定義が明確で、各スコア帯の意味が説明されている
- JSON形式のレスポンスフォーマットにより解析が安定する設計
- `SOCIAL_GOAL_GENERATION_PROMPT`がコミュニティコンテキストを考慮している

**問題点:**

**[M-4] プロンプトの英語問題**

全てのLLMプロンプトが英語で書かれているが、エージェントの発話言語（英語を想定）とプロンプト言語の関係が明示されていない。マルチ言語対応の考慮が将来必要になる可能性がある。ただし、Phase 0では英語のみで問題ない。

#### 2.3 社会グラフ（06 セクション3）

**強み:**
- NetworkXベースの有向重み付きグラフは論文の知見（有向性、非対称性、性格依存性）を正確に反映
- PageRankベースのインフルエンサー検出（L569-580）は論文の文明実験との整合性が高い
- Louvainコミュニティ検出（L582-605）は500体実験の町クラスター分析に適している
- `export_for_visualization`によるD3.js/vis.js連携が考慮されている

**問題点:**

**[L-1] 内部グラフへの直接アクセス**

`PersonalityDrivenInteraction.select_interaction_target`（L848-849）で`social_graph._graph`にプライベートフィールドとして直接アクセスしている。カプセル化を維持するために、`SocialGraph`クラスにクエリメソッドを追加すべき。同様のパターンが`WisdomOfCrowdsAggregator`（L923）、`SocialAwarenessModule`（L1437）にも存在。

#### 2.4 性格モデリング（06 セクション4）

**強み:**
- Big Five性格モデルの採用は心理学的に確立されたフレームワーク
- `generate_random_personality`の二峰性分布（内向/外向の明確な分離）は論文の知見を反映
- `personality_to_behavior`のマッピングが定量的

**問題点:**

**[M-5] Big Fiveモデルの根拠**

論文では性格特性にBig Fiveモデルを使用したとは明示されていない。論文は「固有の性格特性」「内向的/外向的」としか述べていない。Big Fiveの採用は合理的な設計判断だが、論文の記述との対応を明記すべき。

---

### 3. 目標・計画システム

#### 3.1 目標生成モジュール（07 セクション1）

**強み:**
- 目標の4層階層構造（長期→中期→社会的→即時行動）が論文の知見を適切に構造化
- 5-10秒ごとの社会的目標生成が論文と一致
- 5目標のローリングウィンドウ管理が論文の記述を反映
- グラフ構造推論（知識グラフ + 因果グラフ）の2種類のグラフ設計が論文の「グラフ構造上での推論」を具体化

**問題点:**

**[H-3] 社会目標生成の責務重複**

06-social-cognition.md セクション1.3の`SOCIAL_GOAL_GENERATION_PROMPT`と07-goal-planning.md セクション1.4-1.5の`SocialGoalGenerator`が**同じ機能（社会目標の生成）**を別々に定義している。

- 06のL171-193: 社会認識モジュール内で社会目標を生成
- 07のL130-165: 目標生成モジュール内で社会目標を生成
- 06のSocialAwarenessModule.execute()（L1372-1393）で社会目標を生成し、出力に含めている
- 07のGoalGenerationModule.runSocialGoalLoop()（L254-271）でも独立に社会目標ループを実行

どちらのモジュールが社会目標生成の主担当なのかが不明確。論文では目標生成モジュールが社会目標を生成するのが自然だが、社会的コンテキスト（好感度、関係性）は社会認識モジュールが提供する。責務の分離を明確にすべき。

**推奨**: 社会目標の生成ロジック自体は目標生成モジュール(07)に一元化し、社会認識モジュール(06)は社会的コンテキスト（好感度更新、意図推測、対話戦略）の提供に専念させる。

#### 3.2 計画モジュール（07 セクション2）

**強み:**
- HTN + LLMハイブリッドアプローチは、Minecraftの構造化された依存関係（HTN）と動的状況（LLM）の両方に対応
- DEPSパターン（Describe-Explain-Plan-Select）の採用が先行研究との整合性を確保
- 部分再計画戦略（失敗ステップ以降のみ再生成）はリソース効率的

**問題点:**

**[L-2] HTN分解ルールの不足**

HTNDecomposerの具体的な分解ルール（Method定義）が示されていない。Minecraftのクラフトレシピに対応するHTNメソッドの設計は実装の中核部分であり、少なくとも代表的な例（木のツルハシ→石のツルハシへの技術進行）のメソッド定義を含めるべき。

#### 3.3 行動認識モジュール（07 セクション3）

**強み:**
- 論文の「最も重要なモジュール」という位置づけを正確に反映
- 非LLMニューラルネットワークの具体的なアーキテクチャ設計（入力288次元→128→64→出力4ヘッド）
- ハルシネーション連鎖の問題パターンと解決策が明確
- ループ検出サブモジュール（n-gram分析）は実用的

**問題点:**

**[C-2] 学習データの鶏と卵問題**

07-goal-planning.md L650-688の学習データ収集パイプラインは、**エージェントが既に動作していることを前提**としている。しかし、Phase 0ではエージェントシステム自体がまだ存在しないため、行動認識NNの学習データを収集できない。

この根本的な問題に対する解決策が記述されていない。推奨されるアプローチ:
1. Phase 0ではルールベースの行動認識（インベントリの直接比較等）で代替
2. 初期エージェント稼働後にデータ収集→NNモデル学習のパイプラインを構築
3. 合成データ（意図的な改ざん）による事前学習

07のL670-673の表で「合成データ」が言及されているが、具体的な合成方法が不足。

#### 3.4 自己省察モジュール（07 セクション4）

**強み:**
- Reflexionフレームワークの3段階プロセス（要約→評価→教訓抽出）の採用
- トリガー種別の網羅性（定期/目標完了/重大イベント/社会的/行動認識/アイドル）
- 振り返り結果の記憶システムへの統合パスが明確

**問題点:**

**[L-3] 自己省察の計算コスト**

自己省察モジュールはLLMを使用する低速モジュールだが、エージェントあたりの呼び出し頻度（2-5分ごと）がコスト的に問題になる可能性がある。50体で2分間隔の場合、1時間あたり1500回のLLM呼び出しとなる。コスト概算への影響が09-evaluation.mdで言及されていない。

---

### 4. 評価指標

#### 4.1 文明的指標の網羅性

**強み:**
- 論文の3軸（専門化・統治・文化伝播）が全て網羅されている
- 追加として社会的認知精度とアイテム収集ベンチマークも含まれ、5軸評価に拡張
- 各指標に数学的定義と実装コードが対応している

論文のベンチマーク次元（05-civilization.md L180-194）との対応:

| 論文の次元 | 09-evaluation.md での対応 | 評価 |
|---|---|---|
| 専門化（役割エントロピー、持続時間、行動-役割相関） | セクション2で全3指標を実装 | 完全 |
| 制度的統治（税遵守率、憲法修正反映度） | セクション3で税遵守率・憲法プロセスを実装 | 完全 |
| 文化的伝播（ミーム発生数、地理的範囲、改宗率） | セクション4で3指標全てを実装 | 完全 |
| インフラ発展 | 未実装 | 欠落 |
| 社会的認知（ピアソン相関） | セクション5で実装 | 完全 |
| 個体能力（アイテム収集） | セクション6で実装 | 完全 |

**[H-4] 「インフラ発展」指標の欠落**

論文分析（05-civilization.md L187）で挙げられている「インフラ発展 — 制度の機能的運用度」の指標が09-evaluation.mdに含まれていない。論文ではこの次元の定量的指標が十分に定義されていないため、実装困難な可能性はあるが、欠落の理由を明記すべき。

#### 4.2 測定方法の具体性

**専門化指標**:
- 役割エントロピーの数学的定義（Shannon entropy）が明確（09: L51-53）
- GPT-4o役割推論パイプラインの実装が具体的（バッチ処理、コスト最適化を含む）
- 行動-役割相関のピアソン相関計算が実装されている

**統治指標**:
- 税遵守率の判定基準（要求額の90%以上で遵守とみなす）が明確（09: L428）
- 憲法修正プロセスの4フェーズが定義されている
- インフルエンサー影響度の測定が会話ログと投票結果の突合で実装

**文化伝播指標**:
- キーワードベース + LLMベースの2手法が論文と一致
- 地理的伝播のヒートマップ生成が実装されている
- SIRモデルフィッティングによる伝播パラメータ推定が含まれている

**社会的認知精度**:
- 観察者閾値スイープ（1-15）の実装が論文の図の再現に対応
- Fisher z変換によるアブレーション比較が統計的に適切

**[M-6] 測定頻度の未定義**

各メトリクスの測定・計算頻度が明示されていない。リアルタイムで計算するのか、バッチで定期計算するのかの設計方針が不足。例えば:
- 役割エントロピー: リアルタイム（目標更新ごと）かスナップショット（1分ごと）か
- 税遵守率: 課税シーズンごとに自動計算か
- ミーム検出: 発話ごとにリアルタイム検出か

---

### 5. マルチエージェント連携

#### 5.1 社会的インタラクション設計

**強み:**
- 感情→行動変換ロジック（06: SentimentToActionConverter）が論文の食料配分実験を正確に再現
- インフルエンサー影響力モデル（06: InfluenceModel）が好感度→影響受容度のカーブを定義
- 投票行動モデル（06: VotingInfluenceModel）が論文のタイムラインを反映
- 感情伝播シミュレーション（06: EmotionalContagionSimulator）がSIRモデルとの対応を意識

**問題点:**

**[L-4] 協力・競争のゲーム理論的フレームワークの不足**

論文分析（04-multi-agent.md L85-93）で記述されている協調・競争パターンは、06の感情ベースのみで扱われている。互恵性に基づく協調の判定（L417-424: `should_cooperate`）は単純な平均スコア比較であり、繰り返しゲーム的な戦略（しっぺ返し等）や、間接互恵性の考慮がない。Phase 0ではこの単純化で問題ないが、将来の拡張ポイントとして記録すべき。

#### 5.2 集合知メカニズム

**強み:**
- WisdomOfCrowdsAggregator（06: L890-986）が論文の集合知効果を正確にモデル化
- 重み付き平均（対話回数ベース）による集約が合理的
- 信頼度の計算（観察者数 + 一致度の加重）が適切

---

### 6. 実装の詳細度

#### 6.1 コードに落とし込める具体性

**06-social-cognition.md**: 高い — ほぼ全てのコンポーネントにPythonコードが付属。データクラス、アルゴリズム、LLMプロンプトが具体的。依存パッケージも明記。

**07-goal-planning.md**: 中〜高 — TypeScriptのインターフェース定義が中心で、実装の骨格は示されているが、以下が不足:
- HTN分解ルールの具体例
- 知識グラフの永続化・検索方法
- 行動認識NNの学習コード

**09-evaluation.md**: 高い — 各メトリクスにPython実装コードが付属。統計分析（scipy.stats）、可視化（matplotlib）、データ収集パイプラインまで具体的。

#### 6.2 言語の混在

**[L-5] Python/TypeScriptの混在**

06はPython中心、07はTypeScript中心で記述されている。00-overview.mdで「主言語: Python 3.12+、MCブリッジ: TypeScript (Mineflayer)」と定義されているため、目標生成・計画・行動認識はPythonで実装すべき部分もTypeScriptで書かれている。07のGoalGenerationModule, PlanningModule, ActionAwarenessModuleはPythonで実装するのか、TypeScriptで実装するのかの方針が不明確。

---

## 問題点リスト（優先度付き）

| # | 優先度 | 対象ファイル | 問題の概要 | 推奨対応 |
|---|--------|-------------|-----------|---------|
| C-1 | Critical | 06 | SAS vs Social Awareness Moduleの用語不統一。論文原文との照合が必要 | 論文原文を確認し、用語を統一するか差異の理由を明記 |
| C-2 | Critical | 07 | 行動認識NNの学習データが存在しない段階（Phase 0）での代替手段が未定義 | Phase 0ではルールベース代替を明記。合成データ戦略を具体化 |
| H-1 | High | 09 | 集団ルール実験のタイムライン（課税ウィンドウ20秒 vs 120秒間隔）に不整合 | 論文原文を確認し、「課税ウィンドウ」と「課税シーズン間隔」の定義を修正 |
| H-2 | High | 06 | 感情スコアの時間減衰モデルは論文に根拠がない独自拡張だが、論文準拠のように記述 | 独自拡張であることを明示し、設計根拠を追記 |
| H-3 | High | 06, 07 | 社会目標生成の責務が06（社会認識）と07（目標生成）で重複 | 目標生成は07に一元化、06は社会的コンテキスト提供に専念 |
| H-4 | High | 09 | 論文の「インフラ発展」ベンチマーク次元が欠落 | 欠落理由を明記するか、指標を追加 |
| M-1 | Medium | 06, 09 | 「観察者閾値」の定義が06と09で概念が微妙に異なる | 統一的な定義を設け、06のaggregate_likeabilityのmin_observersを修正 |
| M-2 | Medium | 06 | スムージングパラメータ（20.0, 0.7）の根拠が不明 | チューニング対象として明記し、感度分析の計画を追加 |
| M-3 | Medium | 06 | confidenceデフォルト値0.8は楽観的な可能性 | デフォルト値の根拠を記述するか、初期値を下げる |
| M-4 | Medium | 06, 07 | LLMプロンプトの言語（英語のみ）の方針が未明記 | 言語方針を明記（Phase 0は英語のみ） |
| M-5 | Medium | 06 | Big Fiveモデルの採用根拠が論文との対応で不明確 | 論文の「性格特性」との対応を明記 |
| M-6 | Medium | 09 | 各メトリクスの測定頻度が未定義 | 測定頻度の設計方針セクションを追加 |
| L-1 | Low | 06 | _graphプライベートフィールドへの直接アクセス（複数箇所） | SocialGraphにクエリメソッドを追加 |
| L-2 | Low | 07 | HTN分解ルールの具体例が不足 | 代表的なクラフトレシピの分解例を追加 |
| L-3 | Low | 07 | 自己省察モジュールのLLMコスト影響が未評価 | コスト概算セクションに自己省察のコストを追加 |
| L-4 | Low | 06 | 協力判定がゲーム理論的に単純すぎる | 将来の拡張ポイントとしてドキュメント化 |
| L-5 | Low | 07 | Python/TypeScriptの混在方針が不明確 | 各モジュールの実装言語を明記 |

---

## 推奨事項

### 即座に対応すべき事項（Phase 0開始前）

1. **社会目標生成の責務分離を確定する**: 06と07の重複を解消し、どちらのモジュールが社会目標生成の主責任を持つかを決定する。推奨は07（目標生成モジュール）への一元化。

2. **行動認識モジュールのPhase 0戦略を定義する**: NNモデルの学習データが存在しない初期段階でのフォールバック（ルールベース比較）を07に追記する。

3. **用語の統一**: SAS / Social Awareness Module の用語を論文原文と照合し、ドキュメント全体で統一する。

### Phase 0開発中に対応すべき事項

4. **独自拡張の明示**: 時間減衰、Big Fiveモデル、スムージングパラメータなど、論文に根拠がない設計判断を「独自拡張」として明示的にマーキングする。これにより、論文再現の正確性と独自改善の区別が明確になる。

5. **メトリクス測定頻度の設計**: 各評価指標の計算タイミング（リアルタイム/バッチ/スナップショット）を定義し、データ収集パイプライン（09 セクション7）との整合性を確保する。

6. **実装言語の方針確定**: 07のTypeScript定義をPythonに変換するか、TypeScriptで実装する部分を明確に定義する。

### 長期的改善

7. **LLM評価の循環性への対策強化**: 09セクション9で言及されている「行動ベースの客観指標」をP0レベルに引き上げ、LLM依存指標と並行して常時計測する。

8. **インフラ発展指標の設計**: 論文の4番目のベンチマーク次元を定義し、09に追加する。

9. **統計的検出力の改善**: 09セクション9.4の統計改善策（繰り返し回数増加、ブートストラップ法）を実験計画に組み込む。

---

## 参考: レビュー観点ごとの総合評価

| 観点 | 評価 | コメント |
|---|---|---|
| 論文との整合性 | B+ | 定量結果は正確。用語の不統一と独自拡張の未明示が課題 |
| 社会認知設計 | A- | 技術的に堅実。_graphアクセスパターンのみ改善要 |
| 目標・計画システム | B | 概念設計は優れるが、責務重複と行動認識のブートストラップ問題 |
| 評価指標 | A- | 5軸中4軸を高い具体性で実装。インフラ発展のみ欠落 |
| マルチエージェント連携 | B+ | 感情ベースの設計は論文準拠。ゲーム理論的拡張は将来課題 |
| 実装の詳細度 | B+ | コードレベルの具体性は高いが、言語混在と一部の具体例不足 |
