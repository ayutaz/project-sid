# 実装設計 総合レビュー

## エグゼクティブサマリー

Project Sid再現実装の技術調査ドキュメント（01～10）に対し、セキュリティ、コスト・実現可能性、OSSエコシステム、テスト戦略、統合・整合性の5観点から総合レビューを実施した。

### 全体品質評価

| 観点 | 評価 | 要約 |
|---|---|---|
| 論文カバレッジ | **96%** | PIANOアーキテクチャ100%、個別モジュール94%、実験再現94% |
| 技術スタック整合性 | **Warning** | Error 2件、Warning 8件の不整合あり（CC実行間隔の矛盾、言語混在が最重要） |
| セキュリティ | **要対策** | Critical 3件、High 4件を含む計15件のリスク。Phase 0で3件の最優先対策が必要 |
| コスト実現性 | **Go（MVP）** | MVP $50-100/月で実現可能。500体以上はローカルモデル併用推奨 |
| OSS活用度 | **高** | 必須採用5件、強く推奨4件。独自実装必須6件。開発工数30-40%削減見込み |
| テスト設計 | **概ね適切** | テストピラミッド・LLMモック戦略は適切。LLMモック標準化・パフォーマンスゲートの追加が必要 |

### 最重要アクション（Phase 0で対応必須）

1. **CC実行間隔の統一**: Doc03の動的スケジューリング（1-15秒）を正式仕様に
2. **コード言語方針の明確化**: Python中心、TypeScriptはMCブリッジのみに限定
3. **プロンプトサニタイゼーション層の実装**: LLMインジェクション対策
4. **APIキー管理 + コスト上限設定**: `.env` + `python-dotenv`、月次上限アラート

---

## 1. セキュリティレビュー

### 1.1 リスク一覧

計15件のセキュリティリスクを特定した。

#### Critical（3件）

| # | リスク | 対象Doc | 詳細 |
|---|---|---|---|
| C-1 | **LLMプロンプトインジェクション（エージェント間）** | 02, 03, 06 | エージェントAの発話がエージェントBのLLMプロンプトに直接挿入される。悪意あるエージェント（または外部チャット入力）が他エージェントの行動を操作可能 |
| C-2 | **APIキーの一元管理不備** | 02, 08, 10 | LLM APIキーがLLMゲートウェイに集中。漏洩時に全エージェントのLLM呼び出しが危殆化。コスト上限なしの場合、膨大な請求リスク |
| C-3 | **共有エージェント状態（SAS）の無認証アクセス** | 01, 08 | RedisベースのSASにアクセス制御が未設計。任意のプロセスがエージェント状態を読み書き可能 |

#### High（4件）

| # | リスク | 対象Doc | 詳細 |
|---|---|---|---|
| H-1 | エージェント暴走（無限ループ/リソース枯渇） | 03, 07 | 行動認識モジュールのハルシネーション検出が不完全な場合、LLM API呼び出しが無限に発生 |
| H-2 | Minecraftサーバーへの不正接続 | 05, 08 | online-mode=falseで外部からの不正ボット接続が可能 |
| H-3 | LLM出力の未検証実行 | 05, 07 | Voyager風スキルライブラリがLLM生成コードを実行。コードインジェクションリスク |
| H-4 | 記憶データの汚染 | 04 | ベクトルDB（Qdrant）へのアクセス制御が未設計。記憶の改ざんによりエージェント行動を長期的に操作可能 |

#### Medium（5件）

| # | リスク | 詳細 |
|---|---|---|
| M-1 | ログデータの機密性 | Grafana Lokiへのアクセス制御が未設計 |
| M-2 | 実験設定の改ざん | Hydra設定ファイルの改ざんリスク |
| M-3 | Redis Pub/Subのメッセージ偽装 | エージェント間通信にメッセージ認証がない |
| M-4 | ベクトルDBのスケール攻撃 | 大量の記憶挿入によるサービス拒否 |
| M-5 | 社会グラフの操作 | NetworkXベースの好感度スコア改ざん |

#### Low（3件）

| # | リスク | 詳細 |
|---|---|---|
| L-1 | 評価パイプラインのLLM依存 | GPT-4oによる評価がプロンプトインジェクションの影響を受ける |
| L-2 | スナップショットデータの保護 | S3/MinIOの暗号化が未設計 |
| L-3 | 開発環境と本番環境の分離 | 認証情報の分離が明示されていない |

### 1.2 推奨対策（フェーズ別）

#### Phase 0（最優先）

1. **プロンプトサニタイゼーション層**: XMLタグ・システムプロンプト区切り文字のエスケープ、入力長制限
2. **APIキー管理**: `.env` + `python-dotenv` → Phase 1で Docker Secrets → Phase 2以降でVault。全フェーズ共通で月次コスト上限設定
3. **SASアクセス制御**: Redis ACLによるエージェント別読み書き権限、CASトークン検証

#### Phase 1（高優先）

4. LLM生成コードのサンドボックス実行（Docker内、タイムアウト付き）
5. エージェント暴走防止（API呼び出し上限/分、n-gramループ検出、サーキットブレーカー）
6. ネットワークセキュリティ（TLS通信、MCサーバーのプライベート配置）

#### Phase 2（中優先）

7. 記憶システム保護（Qdrantコレクション分離、署名検証）
8. 監査ログ（全LLM呼び出し・SAS変更の記録）
9. Redis Pub/SubメッセージのHMAC署名

### 1.3 セキュリティ対策優先ランキング

| 順位 | 対策 | リスク | 工数 | 効果 |
|---|---|---|---|---|
| 1 | プロンプトサニタイゼーション | C-1 | 小 | 極大 |
| 2 | APIキー管理+コスト上限 | C-2 | 中 | 極大 |
| 3 | SASアクセス制御 | C-3 | 中 | 大 |
| 4 | エージェント暴走防止 | H-1 | 中 | 大 |
| 5 | コードサンドボックス | H-3 | 大 | 大 |
| 6 | MCサーバー認証 | H-2 | 小 | 中 |
| 7 | TLS通信 | M-3 | 中 | 中 |
| 8 | 記憶システム保護 | H-4 | 大 | 中 |
| 9 | ログアクセス制御 | M-1 | 小 | 小 |
| 10 | 監査ログ | M-2 | 中 | 小 |

---

## 2. コストレビュー

### 2.1 LLM API価格前提（2026年2月時点）

| モデル | 入力 ($/1M tokens) | 出力 ($/1M tokens) | 用途 |
|---|---|---|---|
| GPT-4o | $2.50 | $10.00 | Tier1: CC、目標生成、計画、自己省察 |
| GPT-4o-mini | $0.15 | $0.60 | Tier2: 社会認識、発話 |
| Claude Haiku 4.5 | $1.00 | $5.00 | Tier1代替 |
| Gemini 2.0 Flash | $0.10 | $0.40 | Tier3: 記憶要約 |

### 2.2 スケール別コスト試算

#### LLM + インフラ統合コスト（月額）

| スケール | LLMコスト/月（最適化後） | インフラ/月 | **合計/月** |
|---|---|---|---|
| MVP (1-5体) | $50-100 | $0（ローカル） | **$50-100** |
| 10体 | $640-1,280 | $170 | **$810-1,450** |
| 50体 | $3,200-6,400 | $510 | **$3,710-6,910** |
| 500体 | $20,800-41,600 | $4,600 | **$25,400-46,200** |
| 1,000体 | $36,800-73,600 | $9,200 | **$46,000-82,800** |

LLMコストが全体の**85-90%**を占める。

#### インフラコスト内訳（月額）

| コンポーネント | 10体 | 50体 | 500体 | 1,000体 |
|---|---|---|---|---|
| コンピュート（エージェント） | $50 | $200 | $2,000 | $4,000 |
| Minecraftサーバー | $30 | $50 | $500 | $1,000 |
| Redis | $20 | $50 | $500 | $1,000 |
| PostgreSQL | $20 | $50 | $200 | $400 |
| ベクトルDB (Qdrant) | $0 | $50 | $500 | $1,000 |
| ロードバランサー+ネットワーク | $20 | $50 | $300 | $600 |
| 監視・ログ | $30 | $50 | $500 | $1,000 |
| オブジェクトストレージ | $0 | $10 | $100 | $200 |
| **合計** | **$170** | **$510** | **$4,600** | **$9,200** |

### 2.3 開発工数・人件費

| フェーズ | 期間 | 人月 | 人件費概算 | LLM+インフラ | 合計 |
|---|---|---|---|---|---|
| Phase 0 (2-3ヶ月) | MVP | 5-9 | 400-1,080万円 | 3-5万円 | 400-1,100万円 |
| Phase 1 (3-4ヶ月) | 基盤 | 12-20 | 960-2,400万円 | 50-90万円 | 1,000-2,500万円 |
| Phase 2 (2-3ヶ月) | スケール | 8-12 | 640-1,440万円 | 170-310万円 | 810-1,750万円 |
| Phase 3 (2-3ヶ月) | 文明実験 | 5-9 | 400-1,080万円 | 1,140-2,080万円 | 1,540-3,160万円 |
| **合計** | **9-13ヶ月** | **30-50** | **2,400-6,000万円** | **1,360-2,490万円** | **3,760-8,490万円** |

> 人件費がプロジェクト総コストの60-70%を占める。為替レート$1=150円で概算。

### 2.4 コスト削減戦略の実現性

| 戦略 | 実現的な削減率 | 実現難度 | 判定 |
|---|---|---|---|
| **モデルティアリング** | 40-60% | 低 | **Go** — 最も効果的かつ即時適用可能 |
| **プロンプトキャッシング** | 30-50% | 中 | **Go** — OpenAI/Anthropicネイティブ対応 |
| **セマンティックキャッシュ** | 10-25% | 高 | **Caution** — キャッシュヒット率は楽観的（実際は10-15%程度） |
| **バッチ処理** | 30-40% | 中 | **Caution** — 低速モジュール（目標/計画）のみに限定すべき |
| **ローカルモデル** | 50-80% | 高 | **Phase 2以降で検討** — GPU要件（A100等）と品質検証が必要 |

### 2.5 実現可能性評価

| スケール | 月間コスト | 判定 |
|---|---|---|
| **MVP (1-5体)** | $50-100 | **Go** — 個人開発者でも実施可能 |
| **10体** | $810-1,450 | **Go** — 小規模チームで実施可能 |
| **50体** | $3,710-6,910 | **Caution** — 研究予算が必要 |
| **500体** | $25,400-46,200 | **Caution** — ローカルモデル併用で$10,000-20,000に削減可能性あり |
| **1,000体** | $46,000-82,800 | **要検討** — API価格下落により以前より現実的。ローカルモデル併用推奨 |

---

## 3. OSSレビュー

### 3.1 再利用推奨ランキング

#### Tier 1: 必須採用（そのまま使用）

| # | OSS | ライセンス | 推奨バージョン | 理由 |
|---|---|---|---|---|
| 1 | **Mineflayer + プラグイン** | MIT | 4.x (Node.js 18+) | Minecraft制御の唯一の実用的選択肢 |
| 2 | **Redis** | BSD (7.2以前) | 7.2.x | 共有状態、キャッシュ、Pub/Sub。代替困難 |
| 3 | **NetworkX** | BSD | latest | 社会グラフの標準ライブラリ |
| 4 | **LiteLLM** | MIT | 1.x | LLMマルチプロバイダ対応 |
| 5 | **minecraft-data** | MIT | latest (MC 1.20+) | アイテム・レシピデータ |

#### Tier 2: 強く推奨（主要コンポーネント）

| # | OSS | ライセンス | 推奨バージョン | 理由 |
|---|---|---|---|---|
| 6 | **Qdrant** | Apache 2.0 | 1.12.x+ | ベクトルDB（記憶システム） |
| 7 | **Ray** | Apache 2.0 | 2.40+ | 分散実行（500体以上で必須） |
| 8 | **Prometheus + Grafana** | Apache 2.0 / AGPLv3 | 2.x / 11.x+ | 監視の標準 |
| 9 | **MLflow + Hydra** | Apache 2.0 / MIT | 2.x / 1.3.x | 実験管理・設定管理 |

#### Tier 3: 参考設計（コード再利用せず設計を参照）

| # | OSS | 参照対象 |
|---|---|---|
| 10 | **Voyager** | スキルライブラリ設計、コード生成パイプライン |
| 11 | **Generative Agents** | 記憶システム設計、反省メカニズム |
| 12 | **LIDA** | GWT実装パターン（GPLv3のため設計参照のみ） |
| 13 | **DEPS** | Plan-Selectパターン |
| 14 | **AgentScope** | 大規模エージェント管理パターン |

### 3.2 独自実装が必須な部分

| コンポーネント | 理由 | 推定工数 |
|---|---|---|
| **認知コントローラ(CC)** | PIANOのGWT型ボトルネック+ブロードキャストは既存OSSに該当なし | 大 |
| **モジュールスケジューラ** | 非均一速度での並列モジュール実行は独自設計が必要 | 中 |
| **行動認識NN** | ハルシネーション検出の専用ニューラルネット | 大 |
| **社会認識モジュール** | 感情追跡+好感度推定+集合知は独自アルゴリズム | 中 |
| **文明的ベンチマーク** | 役割エントロピー、税遵守率、ミーム伝播の評価パイプライン | 中 |
| **Mineflayer-PIANOブリッジ** | TypeScript(Mineflayer)とPython(PIANOランタイム)間の接続 | 中 |

### 3.3 ライセンス注意事項

| OSS | ライセンス | 影響 |
|---|---|---|
| LIDA | **GPLv3** | コード直接利用不可。設計参照のみ |
| Grafana | **AGPLv3** | SaaS提供時はソース公開義務。内部利用は問題なし |
| Pufferfish/Velocity | **GPLv3** | バイナリ利用のみ。改変時はソース公開義務 |
| Redis 7.4+ | **SSPL+RSALv2** | BSD版の7.2.xを推奨。代替としてValkey（BSD-3-Clause）も検討可能 |

推奨ライセンス戦略: 再現実装全体はMITまたはApache 2.0で公開。GPLv3コンポーネントは外部依存として利用し本体に含めない。

### 3.4 ローカルモデル導入方針

| フェーズ | 方針 | 理由 |
|---|---|---|
| Phase 0-1 | **API専用** | 品質安定性優先。プロンプト設計・評価基盤の確立に集中 |
| Phase 2 | **Tier2/3からローカル移行開始** | Llama 4/Gemma等に置き換え検証 |
| Phase 3 | **Tier2/3はローカル、Tier1はAPI** | 500体以上でコスト支配的なTier2/3をローカル化で50-70%削減 |

実行基盤: vLLMまたはOllama推奨。A100 40GB x1-2台で50体、A100 80GB x4台で500体規模を想定。

---

## 4. テストレビュー

### 4.1 テストピラミッド

```
                    +---------------+
                    |   E2E         |  5%  (文明実験再現)
                    |   Tests       |
                 +--+---------------+--+
                 |  Integration        |  20% (モジュール間連携)
                 |  Tests              |
              +--+---------------------+--+
              |  Unit Tests               |  75% (各モジュール単体)
              |  (Module-level)           |
              +---------------------------+
```

| 層 | 比率 | LLM使用 | 実行時間 | 実行頻度 |
|---|---|---|---|---|
| **Unit Tests** | 75% | モック | ~5分 | 毎コミット |
| **Integration Tests** | 20% | モック（一部実API） | ~15分 | 毎PR |
| **E2E Tests** | 5% | 実API | ~1-4時間 | Nightly |

### 4.2 LLMテスト戦略

| 層 | 戦略 | ツール |
|---|---|---|
| Unit | 固定レスポンスのモックLLM | `unittest.mock` / MockLLMProvider |
| Integration | 記録済みレスポンスの再生 | VCR.py / カスタムキャッシュプロキシ |
| E2E | 実API（temperature=0） | 直接呼び出し |

プロンプト回帰テスト:
- **構造検証**: LLM出力がJSON Schemaに準拠するか（毎コミット）
- **ゴールデンファイル**: 同一入力での出力をベースラインと比較（毎PR）
- **セマンティックテスト**: LLM-as-judgeで意味的妥当性を評価（Nightly）

### 4.3 セキュリティテスト統合

#### Phase 0で実施すべきテスト

| リスク | テストカテゴリ | テスト内容 | 優先度 |
|---|---|---|---|
| C-1: プロンプトインジェクション | Unit | 100件の既知インジェクションパターンの検出率>=99% | P0 |
| C-1: プロンプトインジェクション | Integration | エージェントAの悪意ある発話がエージェントBの行動を変化させないことの検証 | P0 |
| C-2: APIキー漏洩 | Unit | ログ・エラーメッセージにAPIキーが含まれないことの検証 | P0 |
| C-2: APIキー管理 | Unit | コスト上限超過時にLLM呼び出しがブロックされることの検証 | P0 |
| H-1: エージェント暴走 | Unit | LLM呼び出し回数上限の動作検証 | P0 |

#### CI/CD統合

- **毎コミット**: シークレットスキャン（gitleaks）
- **毎PR**: Python/Node.js依存関係脆弱性スキャン（pip-audit / npm audit）
- **Weekly**: コンテナイメージスキャン（Trivy）

### 4.4 パフォーマンステスト基準

| テスト | 対象 | 指標 | 閾値 |
|---|---|---|---|
| LLM遅延 | LLMゲートウェイ | P95レイテンシ | <5秒 |
| SAS読み書き | Redis | P99レイテンシ | <10ms |
| 記憶検索 | Qdrant | P95レイテンシ | <50ms |
| MCサーバーTPS | Pufferfish | TPS | >15 (20が理想) |

### 4.5 論文結果の再現検証チェックリスト

| 論文結果 | 再現基準 | テスト方法 |
|---|---|---|
| 30分で平均17種アイテム | 15-20種の範囲内 | 25エージェント x 5回 |
| 4時間で約320種飽和 | 280-360種の範囲内 | 49エージェント x 3回 |
| 社会認知 r=0.807 | r>0.7 | 50エージェント x 4回 |
| 6種類の役割分化 | 5種類以上 | 30エージェント x 4回 |
| 税率20%→9%（反税条件） | 有意な税率低下 | 29エージェント x 4回 |

### 4.6 テスト優先実装ランキング

| 順位 | テスト | 工数 | 効果 |
|---|---|---|---|
| 1 | SASのCRUD + 並行アクセスUnit | 小 | 基盤の安定性保証 |
| 2 | MockLLMProvider | 小 | 全モジュールテストの基盤 |
| 3 | CC入出力のスナップショットテスト | 中 | 核心モジュールの品質保証 |
| 4 | 記憶システムのRecall@Kテスト | 中 | 記憶品質の定量評価 |
| 5 | 行動認識の回帰テスト | 中 | ハルシネーション検出の信頼性 |
| 6 | Mineflayerモックサーバー | 大 | MC非依存のテスト環境 |
| 7 | アイテム収集E2E | 大 | 論文再現の基礎検証 |

---

## 5. 統合レビュー

### 5.1 整合性チェック結果

#### Error（対応必須）

| # | 問題 | 詳細 | 修正提案 |
|---|---|---|---|
| 1 | **コード言語の混在** | Doc02/07がTypeScript、Doc01/03/04/06/08/09/10がPython | Pythonインタフェース定義を追加。TypeScriptはMCブリッジ（Doc05）のみに限定 |
| 2 | **CC実行間隔の矛盾** | Doc01: 200ms、Doc03: 1-15秒（動的）、Doc08/10: 2秒 | Doc03の動的スケジューリングを正式仕様。Doc01の200msはスケジューラポーリング間隔として再定義 |

#### Warning（対応推奨）

| # | 問題 | 修正提案 |
|---|---|---|
| 1 | ベクトルDB選定の不一致（Qdrant vs pgvector） | 本番Qdrant + 開発/テストpgvectorの二環境戦略 |
| 2 | MCサーバー種別の不一致（Pufferfish vs Paper） | 開発Paper / 本番Pufferfish |
| 3 | Pythonバージョン揺れ（3.11 vs 3.12+） | 3.12+に統一 |
| 4 | LLMコスト見積もりの前提差異 | 統合コスト見積もり（本セクション2）で解決 |
| 5 | 評価パイプラインの追加DB（TimescaleDB/MongoDB/Neo4j） | PostgreSQL拡張（TimescaleDB + JSONB）で統一 |
| 6 | メモリモジュール速度分類の不統一 | Doc04の三層別定義を正式仕様に |
| 7 | NetworkX社会グラフのスケーラビリティ | 中央管理サービス化 or Redis Graph検討 |
| 8 | Talkingモジュールの設計書不足 | 独立した設計ドキュメントの追加 |

### 5.2 論文カバレッジマトリクス

| カテゴリ | Full | Partial | Missing | カバー率 |
|---|---|---|---|---|
| PIANOアーキテクチャ | 9 | 0 | 0 | **100%** |
| 個別モジュール | 8 | 1 | 0 | **94%** |
| 実験再現 | 8 | 1 | 0 | **94%** |
| **合計** | **25** | **2** | **0** | **96%** |

Partial項目:
1. **Talkingモジュール**: 独立した設計書が存在しない。会話管理（ターン制御、割り込み処理）の詳細が不足
2. **食料配分実験**: 感情推測→行動選択の意思決定アルゴリズムが未定義

### 5.3 クリティカルパス

```
P0-2 --> P1-1 --> P2-1 --> P3-1 --> P3-7 --> P4-1 --> P4-4 --> P5-3
(基盤DB)  (SAS)  (Memory)  (AA)  (CC強化)  (通信)   (k8s)  (500体実験)
```

ボトルネック:
- **P1-1 SAS**: 全モジュールが依存。設計品質がシステム全体の性能を決定
- **P2-1 Memory**: WM/STM/LTM全層 + Qdrant統合
- **P3-7 CC強化版**: 全拡張モジュールの完了が前提。最も依存関係が多い

並列化可能:
- P1-3 (LLM Gateway) と P1-4 (Minecraft Bridge) は独立
- P3-1/P3-2/P3-3 (AA/Goal/Social) は互いに独立
- P5-4 (評価パイプライン) はデータモック使用で先行開発可能

### 5.4 統合リスク（複数Doc横断）

| ID | リスク | 重大度 | 詳細 |
|---|---|---|---|
| IR-01 | SASスキーマと各モジュールのR/Wセクション不整合 | **高** | Doc01のスキーマと各モジュールDocが想定するフィールドの完全マッピング未検証 |
| IR-05 | NetworkX社会グラフとインフラのスケーリング | **高** | インメモリグラフを各エージェントプロセスで保持するとメモリ爆発の恐れ |
| IR-02 | CCブロードキャストとTalkingの連携仕様不足 | 中 | 発話生成の参照フィールド・ロジックの詳細仕様がない |
| IR-03 | Memory遷移とGoal Generationの知識グラフ同期 | 中 | LTM経験と知識グラフ間のデータ同期方法が未定義 |
| IR-04 | 評価パイプラインとランタイムのデータ形式統一 | 中 | 統一イベントスキーマが未定義 |

### 5.5 用語統一

| 概念 | 現状の揺れ | 推奨統一名 |
|---|---|---|
| 共有状態 | SAS / 共有エージェント状態 | **SAS (Shared Agent State)** |
| 認知コントローラ | CC / Cognitive Controller | **CC (Cognitive Controller)** |
| 社会認識 | Social Awareness / 社会認識 / 社会的認知 | **Social Awareness（社会認識）** |
| 感情スコア | sentiment score / likeability score | **sentiment score** |
| 実行間隔 | tick_interval / interval / schedule_interval | **tick_interval** |

---

## クロスカッティング分析

### レビュー間の矛盾解消状況

| 矛盾 | 関連レビュー | 解消状況 |
|---|---|---|
| セキュリティテストのCI/CD統合 | セキュリティ x テスト | **解消**: テストレビュー セクション5でセキュリティテスト戦略を統合済み |
| コスト最適化とモデルティアリング | コスト x OSS | **解消**: 両レビューでPhase 0からモデルティアリング導入を一致推奨 |
| ローカルモデル導入時期 | コスト x OSS | **解消**: Phase 2以降でTier2/3から段階的移行で合意 |
| Redis ライセンス問題 | OSS x 統合 | **解消**: 7.2.x（BSD）推奨、Valkey移行パスを確保 |
| テストカバレッジと論文再現 | テスト x 統合 | **概ね解消**: 5つの再現検証チェックリストが定義済み。ただし統計的検定の具体的実装は未詳細 |

### 共通リスク（複数レビューで指摘）

| リスク | 指摘元レビュー | 影響度 |
|---|---|---|
| **LLMプロンプトインジェクション** | セキュリティ(C-1) + テスト(P0テスト) | 極大 — 全エージェントの行動安全性に影響 |
| **CC実行間隔の矛盾** | 統合(Error) + コスト(コスト試算前提) | 大 — コスト試算・パフォーマンス設計の基盤 |
| **Python-Node.jsブリッジの性能** | 統合(TR-01) + OSS(独自実装) | 大 — Minecraft操作の遅延がシステム全体に波及 |
| **SASスキーマの安定性** | 統合(IR-01, Warning) + テスト(テスト優先#1) | 大 — 全モジュール開発のブロッカーになりうる |
| **LLMコスト管理** | セキュリティ(C-2) + コスト(全体) | 大 — 暴走時の財務リスクとAPIキー漏洩リスク |
| **NetworkX社会グラフのスケーラビリティ** | 統合(IR-05) + OSS(独自実装) | 中 — 500体以上でメモリ問題 |

---

## 推奨アクション一覧（優先度付き）

### P0: Phase 0で必須対応

| # | アクション | 関連レビュー | 工数 |
|---|---|---|---|
| 1 | **CC実行間隔の正式仕様策定** — Doc03の動的スケジューリング（1-15秒）を正式仕様とし、全ドキュメントを更新 | 統合 | 小 |
| 2 | **コード言語方針の明確化** — Python中心、TypeScriptはMCブリッジのみ。Doc02/07にPython型定義を追加 | 統合 | 中 |
| 3 | **プロンプトサニタイゼーション層の実装** — XMLタグ・区切り文字エスケープ、入力長制限 | セキュリティ | 小 |
| 4 | **APIキー管理 + コスト上限設定** — `.env` + `python-dotenv`、月次コスト上限アラート | セキュリティ/コスト | 中 |
| 5 | **SASアクセス制御の設計** — Redis ACL、エージェントIDベース認証 | セキュリティ | 中 |
| 6 | **MockLLMProviderの実装** — 全モジュールテストの基盤 | テスト | 小 |
| 7 | **SAS CRUDテストの実装** — 並行アクセステスト含む | テスト | 小 |
| 8 | **モデルティアリング + プロンプトキャッシング導入** — コスト削減の最優先策 | コスト | 中 |

### P1: Phase 1で対応推奨

| # | アクション | 関連レビュー | 工数 |
|---|---|---|---|
| 9 | ベクトルDB方針の確定（本番Qdrant / 開発pgvector） | 統合/OSS | 小 |
| 10 | MCサーバー方針の確定（開発Paper / 本番Pufferfish） | 統合/OSS | 小 |
| 11 | Pythonバージョンを3.12+に統一 | 統合 | 小 |
| 12 | LLM生成コードのサンドボックス実行 | セキュリティ | 大 |
| 13 | エージェント暴走防止（レート制限 + ループ検出） | セキュリティ | 中 |
| 14 | ネットワークセキュリティ（TLS、MCサーバー認証） | セキュリティ | 中 |
| 15 | Talkingモジュール設計書の追加作成 | 統合 | 中 |
| 16 | SASスキーマv1.0のフリーズ（Phase 1完了時） | 統合 | 小 |
| 17 | 評価メトリクス定義の前倒し（Phase 1でDoc09の指標確定） | 統合/テスト | 小 |
| 18 | Python-Node.jsブリッジの通信方式決定（ZMQ vs gRPC vs REST） | 統合/OSS | 中 |

### P2: Phase 2で対応

| # | アクション | 関連レビュー | 工数 |
|---|---|---|---|
| 19 | 記憶システム保護（Qdrantコレクション分離、署名検証） | セキュリティ | 大 |
| 20 | 監査ログシステムの構築 | セキュリティ | 中 |
| 21 | NetworkX社会グラフのスケーラビリティ対策 | 統合 | 中 |
| 22 | ローカルモデル（Tier2/3）の導入検証 | コスト/OSS | 大 |
| 23 | パフォーマンス回帰テストのCI/CD統合 | テスト | 中 |
| 24 | カオステスト（LLM API障害、MCサーバーダウン） | テスト | 中 |
| 25 | 評価パイプラインのデータストア統合（PostgreSQL拡張） | 統合 | 中 |

### 追加作成が推奨されるドキュメント

| ドキュメント | 内容 | 優先度 |
|---|---|---|
| Talkingモジュール設計書 | CC→Talking連携、会話管理、ターン制御 | 高 |
| SASスキーマ定義書 | 全フィールドの型定義、各モジュールのR/Wマッピング | 高 |
| Python-Node.jsブリッジ仕様書 | 通信プロトコル、シリアライゼーション、エラーハンドリング | 中 |
| 統合テストシナリオ | 複数モジュール連携のE2Eテストケース定義 | 中 |

---

## 参照元ドキュメント

**レビュー元**:
- review-security.md — セキュリティ観点レビュー
- review-cost.md — コスト・実現可能性レビュー
- review-oss.md — OSSエコシステムレビュー
- review-testing.md — テスト戦略レビュー
- review-integration.md — 統合・整合性レビュー

**調査ドキュメント**:
- [01-system-architecture.md](./01-system-architecture.md)
- [02-llm-integration.md](./02-llm-integration.md)
- [03-cognitive-controller.md](./03-cognitive-controller.md)
- [04-memory-system.md](./04-memory-system.md)
- [05-minecraft-platform.md](./05-minecraft-platform.md)
- [06-social-cognition.md](./06-social-cognition.md)
- [07-goal-planning.md](./07-goal-planning.md)
- [08-infrastructure.md](./08-infrastructure.md)
- [09-evaluation.md](./09-evaluation.md)
- [10-devops.md](./10-devops.md)
