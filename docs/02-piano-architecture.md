# 2. PIANOアーキテクチャ

[← 前: 研究の背景と動機](./01-background.md) | [トップ](./index.md) | [次: 単一エージェントの進化 →](./03-single-agent.md)

---

## 2.1 設計哲学

**PIANO（Parallel Information Aggregation via Neural Orchestration）**は、「ピアニストが複数の音符を協調させてハーモニーを生み出すように、様々なモジュールを選択的かつ並行的に実行し、エージェントが環境とリアルタイムで対話することを可能にする」という設計哲学に基づく。

PIANOは、10〜1000以上のAIエージェントがMinecraft環境内で社会的に振る舞うための基盤となる認知アーキテクチャであり、論文全体の実験を支える中核技術である。

---

## 2.2 解決する2つの根本的課題

### 課題1: 並行性の問題（Concurrency）

**問題の本質**: エージェントは「ゆっくり考えること」と「素早く行動すること」を同時に行う必要がある。長期的な計画を立てている最中でも、環境からの脅威に対して即座に反応しなければならない。

**既存手法の限界**: DSPy、LangChain、ellなどの既存フレームワークは、シングルスレッド・逐次実行（single-threaded, sequential functions）を前提として設計されている。すべてのモジュールが均一な時間スケールで動作すると仮定しており、並行プログラミングの設計思想が欠如。

**PIANOの解決策**: 生物学的脳に着想を得た、異なる速度で並列実行されるモジュール群を実装。

| モジュール種別 | 特徴 | 例 |
|---|---|---|
| **高速反射モジュール** | 小規模な非LLMニューラルネットワークで即座に応答 | Action Awareness |
| **低速熟慮モジュール** | グラフ構造上での推論による目標生成・計画立案 | Goal Generation, Planning |
| **選択的起動モジュール** | 状況に応じた選択的実行 | Social Awareness（対話時のみ） |

各モジュールは**ステートレスな操作（stateless operations）**として機能し、共有エージェント状態（Shared Agent State）に対して読み書きを行う。

### 課題2: 一貫性の問題（Coherence）

**問題の本質**: 並行して動作する複数のモジュールが独立に出力を生成すると、エージェントの行動に矛盾が生じる。「手伝う」と言いながらその場を離れる、といった言行不一致が発生しうる。

**PIANOの解決策 — 認知コントローラ（Cognitive Controller: CC）**:

1. **情報ボトルネック（Information Bottleneck）**: CCがエージェント状態から得られる情報を統合・圧縮。提示される情報量を削減しつつ、設計者が情報の流れを明示的に制御
2. **ブロードキャスト（Broadcast Mechanism）**: CCの意思決定を全モジュールに一斉配信。特に発話関連の出力を強く条件付けし、言語的コミットメントと実際の行動の一貫性を強化

この「ボトルネック型の意思決定者がその出力をブロードキャストする」設計は、人間の意識に関する神経科学研究の**Global Workspace Theory（グローバルワークスペース理論）**と一致する。

---

## 2.3 コアモジュール構成

PIANOアーキテクチャは**約10個の専門化されたモジュール**から構成される。

| モジュール | 役割 | 速度 |
|---|---|---|
| **記憶（Memory）** | 会話・行動・観察をWM/STM/LTMの三層構造で保存・検索 | 可変 |
| **行動認識（Action Awareness）** | 自身の状態評価、期待と実際の結果を比較し自己修正 | 高速 |
| **目標生成（Goal Generation）** | グラフ構造上での推論による目的創出 | 低速 |
| **社会認識（Social Awareness）** | 社会的手がかりの解釈、協力・適応行動の支援 | 選択的 |
| **発話（Talking）** | 言語の解釈と生成、CCの決定に条件付け | 高速 |
| **スキル実行（Skill Execution）** | 高レベル意図を環境操作に変換 | 高速 |
| **認知コントローラ（CC）** | 情報ボトルネック+ブロードキャストによる一貫性制御 | 中速 |
| **自己省察（Self-Reflection）** | 自身の行動と結果の振り返り | 低速 |
| **計画（Planning）** | 中長期的行動計画の立案 | 低速 |

### 記憶システムの三層構造

- **作業記憶（Working Memory: WM）**: 現在の状態表現を保持
- **短期記憶（Short-Term Memory: STM）**: 最近の会話や観察を保持
- **長期記憶（Long-Term Memory: LTM）**: 長期にわたる履歴を保持

---

## 2.4 アーキテクチャの全体構造

```
                    [環境（Minecraft）]
                         |
                    [知覚入力]
                         |
                  [共有エージェント状態]
                   /    |    |    \
          [Memory] [Goal] [Social] [Action Awareness] ... (並列実行)
                   \    |    |    /
                  [認知コントローラ (CC)]
                    (情報ボトルネック)
                    (ブロードキャスト)
                   /    |         \
            [Talking] [Skill Exec] [その他出力モジュール]
                         |
                    [環境への行動]
```

**動作フロー**:

1. 環境からの情報が共有エージェント状態に反映
2. 各モジュールが並列に共有状態を読み取り、処理を行い、結果を書き戻す
3. 認知コントローラがボトルネックを通じて情報を統合し、高レベルの意思決定
4. CCの決定が全出力モジュールにブロードキャスト
5. 出力モジュールがCCの決定に条件付けされて具体的な行動・発話を生成

---

## 2.5 既存手法との差別化

| 観点 | 既存フレームワーク（DSPy, LangChain, ell） | PIANO |
|---|---|---|
| **実行モデル** | シングルスレッド・逐次実行 | マルチスレッド・並列実行 |
| **時間スケール** | 均一（全モジュール同一速度） | 不均一（高速反射〜低速熟慮） |
| **一貫性制御** | なし／限定的 | CCによるボトルネック+ブロードキャスト |
| **LLM依存度** | 全処理をLLMで実行 | 高速モジュールは非LLMニューラルネット |
| **情報フロー** | 暗黙的・逐次的 | 明示的制御 |
| **スケーラビリティ** | 単一エージェント向け | 10〜1000+エージェント対応 |
| **設計哲学** | ソフトウェア工学的 | 神経科学・認知科学に着想 |

---

## 2.6 技術的革新性

### 生物学的脳からの着想
PIANOの最も重要な革新は、LLMエージェントの設計に神経科学の知見を明示的に取り入れた点にある。高速反射と低速熟慮の並列処理は生物学的脳の情報処理に類似し、CCのボトルネック+ブロードキャスト設計はGlobal Workspace Theoryに対応する。

### ステートレスモジュール設計
各モジュールをステートレスな操作として設計し、共有状態を介して間接的に通信させることで、モジュールの追加・削除・修正が容易なプラグイン型アーキテクチャを実現。

### 選択的・非均一な実行
文脈に応じた選択的起動と、モジュールごとに異なる実行速度を許容する設計は、計算効率と行動の自然さの両立に貢献。

---

## 2.7 制限事項

1. **計算コストの不透明性**: LLM呼び出し回数や計算コストの定量的分析が論文に含まれていない
2. **モジュール詳細の不完全さ**: 約10モジュールのうち詳細記述は6モジュール程度
3. **記憶システムの時間パラメータ**: WM/STM/LTMの具体的な時間パラメータや容量制限は明記されていない
4. **スケーラビリティの限界**: 1000+エージェント規模ではサーバー容量の制約あり
5. **汎用性の検証**: Minecraft以外の環境での適用可能性は未検証

---

[← 前: 研究の背景と動機](./01-background.md) | [トップ](./index.md) | [次: 単一エージェントの進化 →](./03-single-agent.md)
